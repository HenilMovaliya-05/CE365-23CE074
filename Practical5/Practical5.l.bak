%{
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int line = 1;
char symbol_table[100][100];
int sym_count = 0;

int is_present(char *str) {
    for(int i = 0; i < sym_count; i++) {
        if(strcmp(symbol_table[i], str) == 0)
            return 1;
    }
    return 0;
}

void add_symbol(char *str) {
    if(!is_present(str)) {
        strcpy(symbol_table[sym_count], str);
        sym_count++;
    }
}
%}

DIGIT       [0-9]
LETTER      [a-zA-Z_]
ID          {LETTER}({LETTER}|{DIGIT})*
NUM         {DIGIT}+(\.{DIGIT}+)?
CHARCONST   \'([^\\\n]|(\\.))\'
STRING      \"([^\\\n]|(\\.))*\"

KEYWORD     int|char|float|double|return|if|else|while|for|do|break|continue|void|long|short|switch|case|default|const|static

OPERATOR    \+|\-|\*|\/|\=|\+=|\-=|\*=|\/=|==|!=|<=|>=|<|>|\+\+|\-\-

PUNCT       \(|\)|\{|\}|\[|\]|\,|\;|\:

%%

"//".*                      { /* single line comment ignore */ }
"/*"([^*]|[\r\n]|"*"[^/])*"*/"   { /* multi-line comment ignore */ }

{KEYWORD}      { printf("Keyword: %s\n", yytext); }

{ID}           {
                    printf("Identifier: %s\n", yytext);
                    add_symbol(yytext);
                }

{NUM}          { printf("Constant: %s\n", yytext); }

{CHARCONST}    { printf("Constant: %s\n", yytext); }

{STRING}       { printf("String: %s\n", yytext); }

{OPERATOR}     { printf("Operator: %s\n", yytext); }

{PUNCT}        { printf("Punctuation: %s\n", yytext); }


[ \t\r]+       { /* ignore spaces */ }

\n             { line++; }


.              { printf("Line %d : %s invalid lexeme\n", line, yytext); }

%%

int main(int argc, char *argv[])
{
    if(argc < 2) {
        printf("Usage: %s <inputfile>\n", argv[0]);
        return 1;
    }

    FILE *fp = fopen(argv[1], "r");
    if(!fp) {
        printf("Cannot open file\n");
        return 1;
    }

    yyin = fp;

    printf("TOKENS\n");
    yylex();

    printf("\nSYMBOL TABLE ENTRIES\n");
    for(int i = 0; i < sym_count; i++) {
        printf("%d) %s\n", i+1, symbol_table[i]);
    }

    fclose(fp);
    return 0;
}

int yywrap() {
    return 1;
}
